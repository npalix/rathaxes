\documentclass[francais]{rtxarticle}

\usepackage{listings}
\usepackage{tikz}
\usetikzlibrary{shapes,fit}

\lstset{%
basicstyle=\ttfamily\footnotesize\color{LightGray},
backgroundcolor=\color{black}
}

\tikzset{warrow/.style={->, >=stealth, color=black, ultra thick}}

\tikzset{graybox/.style={draw,rectangle,rounded corners=3pt,very thick,densely dashed,color=gray!75,text=black}}
\tikzset{redbox/.style={draw,rectangle,rounded corners=5pt,ultra thick,color=rathaxesred,text=white}}
\tikzset{redcontainer/.style={draw,rectangle,rounded corners=5pt,ultra thick,color=rathaxesred,text=white,minimum height=3.5cm,minimum width=2.5cm}}

\title{Premiers Pas}
\author{Louis Opter}

\rtxdoctype{Documentation Utilisateur}
\rtxdocstatus{Brouillon}
\rtxdocversion{0.2}

\rtxdochistory
{
0.1 & 09/04/2011 & Louis Opter & Traduction de la version Anglaise \\
\hline
0.2 & 19/07/2011 & Louis Opter & Ajout d'une vue d'ensemble de la génération d'un pilote \\
}

\begin{document}

\maketitle

\begin{abstract}
\rtx\ est un Langage de programmation Spécifique à un Domaine (DSL) qui permet
de décrire des pilotes de périphériques. \rtx\ compile vers des modules noyaux
écrits en C pour Linux, Windows et OpenBSD.

Ce document explique comment installer \rtx\ sous Windows et les systèmes
d'exploitations de type Unix et comment générer votre premier pilote de
périphérique.

Vous trouverez aussi dans ce document des liens vers la documentation complète
et comment compiler la dernière la version de \rtx.
\end{abstract}

\tableofcontents

\pagebreak

\section{Installation}

Un installateur existe pour Windows, sur les autres systèmes d'exploitation
seulement une installation depuis les sources est supportée pour le moment.
Bien sûr, si vous souhaitez développer sur \rtx\ en lui même vous pouvez
choisir d'installer \rtx\ depuis les sources (càd sans l'installateur).

Bien que \rtx\ génère des pilotes uniquement pour Windows, Linux et OpenBSD il
est possible de l'installer et de l'utiliser depuis d'autre systèmes (comme
d'autre BSD et MacOS~X).

\subsection{Avec l'installateur Windows}

L'installateur fournis pour Windows inclut tout ce dont vous avez besoin pour
écrire des pilotes en utilisant \rtx\ : le compilateur et sa documentation.

Téléchargez l'\href{http://rathaxes.googlecode.com/files/rathaxes-latest.exe}{installeur},
puis exécuter le et suivez les instructions sur l'écran.

Pour compiler et utiliser les pilotes générés par \rtx\ vous aurez besoin
d'installer le kit de développement de pilotes de périphériques de Microsoft
Windows.

\subsection{Depuis les sources sur Unix}

Si vous n'utilisez pas Windows vous êtes obligés d'installer \rtx\ depuis les
«~sources~».

Installez CMake >= 2.6 et téléchargez la dernière
\href{http://rathaxes.googlecode.com/files/rathaxes-src-latest.tar.gz}{archive
des sources}.

Ensuite, extrayez l'archive et deplacez vous avec «~cd~» à l'intérieur. Enfin
vous pouvez installer \rtx\ avec les lignes de commandes suivantes :

\begin{lstlisting}
$ mkdir build
$ cd build
$ cmake -DCMAKE_INSTALL_PREFIX=/usr/local/ -DCMAKE_BUILD_TYPE=RELEASE ..
$ sudo make install
\end{lstlisting}

\emph{Vous aurez besoin d'être root pour exécuter «~make install~», cet exemple
utilise «~sudo~» mais adaptez le à votre installation locale}.

\section{Générer votre premier pilote}

Si vous êtes sous Windows ouvrez le «~Rathaxes Shell~», sinon ouvrez votre
émulateur de terminal favoris.

TBD.

\newpage

\section{Plongée dans \rtx}

Avant d'aborder en détail le compilateur et le langage \rtx\ voici une vue
d'ensemble du processus de génération d'un pilote~:

\begin{figure}[ht!]
\begin{center}
% TODO: we should re-do this drawing horizontally.
\begin{tikzpicture}
\node (RTX) at (2,2.5) {\includegraphics[height=1.5cm]{icons/rtx}};
\draw (RTX.north east) node[below right]{\large{\sffamily{Description du pilote}}};

\node (C) at (2,-3.5) {\includegraphics[height=1.5cm]{icons/c}};

\node[graybox] (AST1) at (2,0.5){\texttt{\large{AST}}};
\draw[warrow] (RTX)--(AST1);

\node[graybox] (AST2) at (2,-1.5) {\texttt{\large{AST}}};
\draw[warrow] (AST2)--(C);

\node[redcontainer] (COMPILER) at (2,-0.5) {};
\draw (COMPILER.south east) node[above right]{\large{\sffamily{Compilateur}}};

\node[graybox] (RTXLINK) at (COMPILER.center) {\texttt{\large{RTX\_Link}}};
\draw[warrow] (AST1)--(RTXLINK);
\draw[warrow] (RTXLINK)--(AST2);

\node (RTI) at (4.5,0.85) {\includegraphics[height=1.3cm]{icons/rti}};
\draw (RTI.east) node[above right]{\large{\sffamily{Interfaces}}};
\draw[warrow] (RTI.west)--(RTXLINK.north);

\node (BLT) at (4.5,-0.5) {\includegraphics[height=1.3cm]{icons/blt}};
\draw (BLT.east) node[above right]{\large{\sffamily{Patrons de code}}};
\draw[warrow] (BLT.west)--(RTXLINK);
\draw (C.north east) node [below right]{\large{\sffamily{Module noyau}}};
\end{tikzpicture}
\caption{Vue d'ensemble de la génération d'un pilote}
\end{center}
\end{figure}

% TODO: explain the different parts of the DSL and how they fit together. And
% give links to their respective documentations here.

\section{Installer la version de développement}

Vous pouvez installer la dernière version de \rtx\ si vous avez besoin d'avoir
les derniers bogues et fonctionnalités ou si vous souhaitez contribuer au
projet. Ceci implique de cloner la dernière version du projet en utilisant
Mercurial et de le compiler manuellement.

\subsection{Pré-requis}

Pour cloner et compiler le projet vous avez besoin d'installer ou d'avoir les
logiciels suivants :
\begin{itemize}
\item Mercurial >= 1.5 (vous pouvez vérifier votre version avec la commande
      «~hg {-}{-}version~» et utiliser
      \href{http://tortoisehg.bitbucket.org/download/index.html}{TortoiseHg}
      sur Windows) ;
\item Subversion (vous devez installer
      \href{http://www.sliksvn.com/en/download}{Slik SVN} qui contient les
      programmes en lignes de commande) ;
\item \href{http://www.cmake.org/cmake/resources/software.html}{CMake} >= 2.6
      (vous pouvez vérifier votre version avec la commande «~cmake {-}{-}version~») ;
\item Une suite d'outils de compilation (par exemple en installant le paquet
      «~build-essential~» sur une distribution GNU/Linux style Debian ou en
      installant
      \href{http://www.microsoft.com/express/Downloads/#2010-Visual-CPP}{Visual
      Studio Express for C++} sur Windows).
\end{itemize}

\emph{Lorsque vous installez CMake sur Windows, assurez vous de choisir
l'option pour ajouter CMake dans le PATH du système pour tous les
utilisateurs.}

\subsection{Cloner les sources}

Ouvrez un shell (faite le depuis le menu de Visual Studio sous Windows) et
cloner le projet en utilisant :

\begin{lstlisting}
$ hg clone https://rathaxes.googlecode.com/hg/ rathaxes
$ cd rathaxes
\end{lstlisting}

Gardez le shell ouvert, la section suivante explique comment compiler \rtx\ sur
Windows ou Unix.

\subsection{Compiler \rtx}

Si vous utilisez un système d'exploitation de type Unix utilisez les commandes
suivantes :

\begin{lstlisting}
$ mkdir build
$ cd build
$ cmake ..
$ make
\end{lstlisting}

Si vous êtes sous Windows utilisez :

\begin{lstlisting}
$ mkdir build
$ cd build
$ cmake -G "NMake Makefiles" ..
$ nmake
\end{lstlisting}

\rtxmaketitleblock

\end{document}
