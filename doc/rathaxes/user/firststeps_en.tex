\documentclass[american]{rtxarticle}

\usepackage{listings}
\usepackage{tikz}
\usetikzlibrary{shapes,fit}

\lstset{%
basicstyle=\ttfamily\footnotesize\color{LightGray},
backgroundcolor=\color{black}
}

\tikzset{warrow/.style={->, >=stealth, color=black, ultra thick}}

\tikzset{graybox/.style={draw,rectangle,rounded corners=3pt,very thick,densely dashed,color=gray!75,text=black}}
\tikzset{redbox/.style={draw,rectangle,rounded corners=5pt,ultra thick,color=rathaxesred,text=white}}
\tikzset{redcontainer/.style={draw,rectangle,rounded corners=5pt,ultra thick,color=rathaxesred,text=white,minimum height=2.5cm,minimum width=6cm}}

\title{First steps}
\author{Louis Opter}

\rtxdoctype{User Documentation}
\rtxdocstatus{Draft}
\rtxdocversion{0.4}

\rtxdochistory
{
0.1 & 04/07/2011 & Louis Opter & Initial release \\
\hline
0.2 & 04/09/2011 & Louis Opter & Lot of improvements \\
\hline
0.3 & 04/09/2011 & David Pineau & Quick fixes \\
\hline
0.4 & 07/19/2011 & Louis Opter & Add on overview of the generation of a driver \\
}

\begin{document}

\maketitle

\begin{abstract}
\rtx\ is a Domain Specific Language to describes peripherals drivers. It
compiles to kernel modules written in C for Linux, Windows and OpenBSD.

This document explains how to setup the \rtx\ compiler on Windows and Unix like
platforms and generate your first peripheral driver.

This document will also give you links to the complete documentation and
explains how to build the latest version of \rtx.
\end{abstract}

\tableofcontents

\pagebreak

\section{Installation}

An installer exists for Windows, on other operating systems only installations
from the sources are supported at the moment. Of course, if you intend to
develop on \rtx\ itself from Windows you can also choose to install \rtx\ from
the sources (i.e. without the installer).

Although \rtx\ only generate drivers for Windows, Linux and OpenBSD it can be
installed and used from others operating systems as well (including other BSDs
and MacOS~X).

\subsection{Using the Windows installer}

An installer is available for Windows. It includes everything you need to write
drivers using \rtx: the \rtx\ compiler and its documentation.

Download the \href{http://rathaxes.googlecode.com/files/rathaxes-latest.exe}{installer},
then simply execute it and follow the instructions on your screen.

To build and use the drivers generated by \rtx\ you will also need the
Microsoft Driver Development Kit.

\subsection{From the sources on Unix}

If you are not on Windows you will have to install \rtx\ from a ``source
release''.

You will need to have CMake >= 2.6 installed and to download a
\href{http://rathaxes.googlecode.com/files/rathaxes-src-latest.tar.gz}{\rtx\ source tarball}.

Then extract the source tarball and ``cd'' into it, finally you can install
\rtx\ using:

\begin{lstlisting}
$ mkdir build
$ cd build
$ cmake -DCMAKE_INSTALL_PREFIX=/usr/local/ -DCMAKE_BUILD_TYPE=RELEASE ..
$ sudo make install
\end{lstlisting}

\emph{You will need to be root to issue ``make install'', this example uses
``sudo'' but accord this to your local setup.}

\section{Generate your first driver}

If you are on Windows open the ``Rathaxes Shell'', otherwise open your favorite
terminal emulator.

TBD.

\newpage

\section{Diving in}

Before we explain the compiler and the language in details here is an overview
of the generation of a driver:

\begin{figure}[ht!]
\begin{center}
\begin{tikzpicture}
\node (RTX) at (-5,0) {\includegraphics[height=1.5cm]{icons/rtx}};
\draw (RTX.south) node[below]{\large{\sffamily{Driver description}}};

\node (C) at (5,0) {\includegraphics[height=1.5cm]{icons/c}};
\draw (C.south) node [below]{\large{\sffamily{Kernel module}}};

\node[graybox] (AST1) at (-2,0){\texttt{\large{AST}}};
\draw[warrow] (RTX)--(AST1);

\node[graybox] (AST2) at (2,0) {\texttt{\large{AST}}};
\draw[warrow] (AST2)--(C);

\node[redcontainer] (COMPILER) at (0,0) {};
\draw (COMPILER.south) node[below]{\large{\sffamily{Compiler}}};

\node[graybox] (RTXLINK) at (COMPILER.center) {\texttt{\large{RTX\_Link}}};
\draw[warrow] (AST1)--(RTXLINK);
\draw[warrow] (RTXLINK)--(AST2);

\node (RTI) at (-1.5,2.7) {\includegraphics[height=1.3cm]{icons/rti}};
% The hidden character is a hack to verticaly align "Code templates" and "Interfaces"
\draw (RTI.north west) node[above right]{\large{\sffamily{Interfaces\textcolor{white}{p}}}};
\draw[warrow] (RTI.south)--(RTXLINK);

\node (BLT) at (0.5,2.7) {\includegraphics[height=1.3cm]{icons/blt}};
\draw (BLT.north west) node[above right]{\large{\sffamily{Code templates}}};
\draw[warrow] (BLT.south)--(RTXLINK);
\end{tikzpicture}
\caption{Overview of the generation of a driver}
\end{center}
\end{figure}

% TODO: explain the different parts of the DSL and how they fit together. And
% give links to their respective documentations here.

\section{Install the development version}

You can install the latest version of \rtx\ if you need to have the latest bugs
and features or if you want to contribute to the project. This involves checking
out the current version of the project using Mercurial and to build it manually.

\subsection{Pre-requisites}

To checkout and build the project you need to install the following softwares:
\begin{itemize}
\item Mercurial >= 1.5 (you can check the version with ``hg {-}{-}version'' and
      use \href{http://tortoisehg.bitbucket.org/download/index.html}{TortoiseHg}
      on Windows);
\item Subversion (you need to install \href{http://www.sliksvn.com/en/download}{Slik
      SVN} on Windows which ships the command line executables);
\item \href{http://www.cmake.org/cmake/resources/software.html}{CMake} >= 2.6
      (you can check the version with ``cmake {-}{-}version'');
\item A compiler tool-chain (for example by installing the ``build-essential'' package on a
      Debian-like GNU/Linux distribution or by installing
      \href{http://www.microsoft.com/express/Downloads/#2010-Visual-CPP}{Visual Studio Express for C++}
      on Windows).
\end{itemize}

\emph{When you install CMake on Windows, make sure to select the option to add
CMake to the system PATH for all users.}

\subsection{Checkout the sources}

Open a shell (you can do this from the Visual Studio menu on Windows), and
checkout the project using:

\begin{lstlisting}
$ hg clone https://rathaxes.googlecode.com/hg/ rathaxes
$ cd rathaxes
\end{lstlisting}

Keep the shell open, the next section explains how to build \rtx\ on Windows or
Unix.

\subsection{Build \rtx}

If you are using an Unix like operating system use the following commands:

\begin{lstlisting}
$ mkdir build
$ cd build
$ cmake ..
$ make
\end{lstlisting}

If you are on Windows use:

\begin{lstlisting}
$ mkdir build
$ cd build
$ cmake -G "NMake Makefiles" ..
$ nmake
\end{lstlisting}

\rtxmaketitleblock

\end{document}
